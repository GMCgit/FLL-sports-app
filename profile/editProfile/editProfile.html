<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit your profile</title>
    <link rel="stylesheet" type="text/css" href="editProfile.css" />
  </head>
  <body>
    <div id="content">
      <nav id="navbar" class="navbar navbar-expand-lg navbar-light bg-light">
        <div id="username" class="navbar-brand"></div>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <button class="nav-link btn" onclick="toMain()">Main</button>
            </li>
            <li class="nav-item">
              <button class="nav-link btn" onclick="toProfile()">
                My Profile
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link btn" onclick="toMap()">Map</button>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Other people
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">My friends</a>
                <a class="dropdown-item" href="#">Blocked people</a>
                <div class="dropdown-divider"></div>
                <div id="searchPeople">
                  <div class="form-inline my-2 my-lg-0">
                    <input
                      class="form-control mr-sm-2"
                      type="search"
                      placeholder="Search"
                      aria-label="Search"
                      id="userEntered"
                      onchange="searchPeople()"
                    />
                    <button
                      class="btn btn-outline-success my-2 my-sm-0"
                      type="submit"
                      onclick="searchPeople()"
                    >
                      Search
                    </button>
                    <hr />
                  </div>
                </div>
                <div id="Results">
                  <button
                    id="ResButt"
                    class="invis"
                    onclick="goToPerson()"
                  ></button>
                  <div id="DocId" class="invis"></div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </nav>
      <div id="profileBg" />
      <div id="profile">
        <div id="Username"></div>
        <input type="text" id="new_username" placeholder="Enter new username" />
        <br />
        <button class="btn btn-primary " onclick="change_username()">
          Change username
        </button>
        <hr />
        <div id="Name"></div>
        <input type="text" id="new_name" placeholder="Enter new username" />
        <br />
        <button class="btn btn-primary " onclick="change_name()">
          Change name
        </button>
        <hr />
        <input type="password" id="new_pass" placeholder="Enter new password" />
        <input type="password" id="old_pass" placeholder="Enter current password" />
        <br />
        <button class="btn btn-danger " onclick="PassChange()">
          Change password
        </button>
        <hr />
        <form>
          <label for="phone">Optional options:</label>
          <br />
          <input
            type="tel"
            id="phone"
            name="phone"
            placeholder="add phone number"
            pattern="[0-9]{3} [0-9]{3} [0-9]{3}"
          />
          <br />
          <input
            type="tel"
            id="sport"
            name="sport"
            placeholder="add favourite sport"
          />
          <br />
          <input
            type="number"
            id="age"
            name="age"
            placeholder="change your age"
          />
          <hr />

          <input type="button" value="submit" />
        </form>
      </div>
    </div>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-analytics.js"></script>

    <script>
      let firebaseConfig = {
        apiKey: "AIzaSyCM2sEUC8IruO3FAd5AczvgxfqIUZ5ayoM",
        authDomain: "fll-sports-app.firebaseapp.com",
        databaseURL: "https://fll-sports-app.firebaseio.com",
        projectId: "fll-sports-app",
        storageBucket: "fll-sports-app.appspot.com",
        messagingSenderId: "984650261585",
        appId: "1:984650261585:web:75826e5684ec5ee71f8470",
        measurementId: "G-TH76ZB69PB",
      };

      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
    </script>

    <script>
      function searchPeople() {
        const searchTerm = document.getElementById("userEntered");

        let db = firebase.firestore();
        let user;

        db.collection("users")
          .get()
          .then((querySearch) => {
            querySearch.forEach((doc) => {
              let Username = doc.data().username;
              if (Username.startsWith(searchTerm.value)) {
                user = {
                  username: Username,
                  docId: doc.id,
                  name: doc.data().name,
                };
              }
            });
          })
          .then(() => {
            let child = document.getElementById("ResButt");
            child.innerHTML = user.username;
            child.classList.remove("invis");
            child.classList.add("btn");
            child.classList.add("btn-outline-dark");
            child.classList.add("SearchResult");
            child.classList.add("btn-lg");
            document.getElementById("Results").appendChild(child);
            let obj = { ...user };
            document.getElementById("DocId").innerHTML = JSON.stringify(obj);
          });
      }

      function goToPerson() {
        let docId = document.getElementById("DocId").innerHTML;

        sessionStorage.removeItem("docId");
        sessionStorage.setItem("docId", docId);

        window.location = "../othersProfile/others.html";
      }
    </script>
    <style>
      .SearchResult {
        border: 1px solid black;
        border-radius: 5px;
        width: 60vw;
        height: 5vh;
        text-align: center;
        margin-left: calc((100vw - 60vw) / 2);
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .invis {
        visibility: hidden;
      }
    </style>

    <script src="./editProfile.js" defer></script>
  </body>
</html>
